<!DOCTYPE html>
<html lang="ja">
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- flatpickr CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #f5f2fa;
        font-family: "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 640px;
        background: #ffffff;
        padding: 2rem;
        margin: 2rem auto;
        border-radius: 1rem;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }
      h2 {
        font-weight: bold;
        color: #5c4b8a;
        font-size: 1.8rem;
        text-align: center;
      }
      .form-label {
        font-weight: 500;
        font-size: 1rem;
      }
      .form-control,
      .form-select {
        font-size: 1.1rem;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
      }
      .btn-purple {
        background-color: #9b59b6;
        border: none;
        color: white;
        font-size: 1.2rem;
        padding: 0.9rem;
        border-radius: 0.5rem;
      }
      .btn-purple:hover {
        background-color: #8e44ad;
      }
      #result {
        white-space: pre-wrap;
        min-height: 4em;
        font-size: 1rem;
      }
      .alert-custom {
        background: #fdf8f3;
        border-radius: 0.75rem;
        border: 1px solid #e6ddd5;
        padding: 1.25rem;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h2 class="mb-4">-- 今月のあなた --</h2>

      <div class="mb-3">
        <label for="lastName" class="form-label">姓</label>
        <input
          type="text"
          id="lastName"
          class="form-control"
          placeholder="例：山田"
        />
      </div>

      <div class="mb-3">
        <label for="firstName" class="form-label">名</label>
        <input
          type="text"
          id="firstName"
          class="form-control"
          placeholder="例：花子"
        />
      </div>

      <div class="mb-3">
        <label for="birth" class="form-label">生年月日</label>
        <input
          type="text"
          id="birth"
          class="form-control"
          placeholder="クリックして選択"
        />
      </div>

      <div class="mb-3">
        <label for="gender" class="form-label">性別</label>
        <select id="gender" class="form-select">
          <option value="女性">女性</option>
          <option value="男性">男性</option>
          <option value="その他">その他</option>
        </select>
      </div>

      <button onclick="runUranai()" class="btn btn-purple w-100">
        診断スタート
      </button>

      <div id="result" class="mt-4 alert alert-custom"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      flatpickr("#birth", {
        dateFormat: "Y-m-d",
        maxDate: "today",
        locale: "ja",
      });
    </script>

    <!-- GAS連携 -->
    <script>
      function runUranai() {
        const resultBox = document.getElementById("result");
        resultBox.innerText = "占い中…しばらくお待ちください⏳";

        const data = {
          lastName: document.getElementById("lastName").value,
          firstName: document.getElementById("firstName").value,
          birth: document.getElementById("birth").value,
          gender: document.getElementById("gender").value,
        };

        google.script.run
          .withSuccessHandler(function (response) {
            if (typeof response === "object" && response.success === false) {
              resultBox.innerText = `⚠️ ${response.message}`;
            } else {
              resultBox.innerText = response;
            }
          })
          .withFailureHandler(function (error) {
            console.error("占いエラー:", error);
            resultBox.innerText =
              "うまく占いができませんでした💦 もう一度お試しください。";
          })
          .getUranaiResult(data);
      }
    </script>
  </body>
</html>
